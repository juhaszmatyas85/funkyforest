window.wp=window.wp||{},function(i,u){"use strict";u.hellopack={},u.hellopack.ajaxNonce=window._wpUpdatesSettings.ajax_nonce,u.hellopack.shouldRequestFilesystemCredentials=null,u.hellopack.filesystemCredentials={ftp:{host:null,username:null,password:null,connectionType:null},ssh:{publicKey:null,privateKey:null}},u.hellopack.updateLock=!1,u.hellopack.updateDoneSuccessfully=!1,u.hellopack.updateQueue=[],u.hellopack.$elToReturnFocusToFromCredentialsModal=null,u.hellopack.decrementCount=function(e){var a,t=i("#wp-admin-bar-updates .ab-label"),n=i('a[href="update-core.php"] .update-plugins'),o=i("#menu-plugins"),s=t.text();(s=parseInt(s,10)-1)<0||isNaN(s)||(i("#wp-admin-bar-updates .ab-item").removeAttr("title"),t.text(s),n.each(function(e,t){t.className=t.className.replace(/count-\d+/,"count-"+s)}),n.removeAttr("title"),n.find(".update-count").text(s),"plugin"===e&&(a=o.find(".plugin-count").eq(0).text(),(a=parseInt(a,10)-1)<0||isNaN(a)||(o.find(".plugin-count").text(a),o.find(".update-plugins").each(function(e,t){t.className=t.className.replace(/count-\d+/,"count-"+a)}),0<a?i(".subsubsub .upgrade .count").text("("+a+")"):i(".subsubsub .upgrade").remove())))},u.hellopack.updatePlugin=function(e,t){var a=i(".hellopack-card-"+t).find(".update-now"),n=a.data("name"),n=u.i18n.sprintf(u.i18n.__("Updating %s...","hellopack-client"),n);a.attr("aria-label",n),a.addClass("updating-message"),a.html()!==n&&a.data("originaltext",a.html()),a.text(n),u.hellopack.updateLock?u.hellopack.updateQueue.push({type:"update-plugin",data:{plugin:e,slug:t}}):(u.hellopack.updateLock=!0,a={_ajax_nonce:u.hellopack.ajaxNonce,plugin:e,slug:t,username:u.hellopack.filesystemCredentials.ftp.username,password:u.hellopack.filesystemCredentials.ftp.password,hostname:u.hellopack.filesystemCredentials.ftp.hostname,connection_type:u.hellopack.filesystemCredentials.ftp.connectionType,public_key:u.hellopack.filesystemCredentials.ssh.publicKey,private_key:u.hellopack.filesystemCredentials.ssh.privateKey},u.ajax.post("update-plugin",a).done(u.hellopack.updateSuccess).fail(u.hellopack.updateError))},u.hellopack.updateTheme=function(e){var t=i(".hellopack-card-"+e).find(".update-now"),a=t.data("name"),a=u.i18n.sprintf(u.i18n.__("Updating %s...","hellopack-client"),a);t.attr("aria-label",a),t.addClass("updating-message"),t.html()!==a&&t.data("originaltext",t.html()),t.text(a),u.hellopack.updateLock?u.hellopack.updateQueue.push({type:"update-theme",data:{theme:e}}):(u.hellopack.updateLock=!0,t={_ajax_nonce:u.hellopack.ajaxNonce,theme:e,slug:e,username:u.hellopack.filesystemCredentials.ftp.username,password:u.hellopack.filesystemCredentials.ftp.password,hostname:u.hellopack.filesystemCredentials.ftp.hostname,connection_type:u.hellopack.filesystemCredentials.ftp.connectionType,public_key:u.hellopack.filesystemCredentials.ssh.publicKey,private_key:u.hellopack.filesystemCredentials.ssh.privateKey},u.ajax.post("update-theme",t).done(u.hellopack.updateSuccess).fail(u.hellopack.updateError))},u.hellopack.updateSuccess=function(e){var t=i(".hellopack-card-"+e.slug),a=t.find(".column-update"),n=t.find(".update-now"),t=t.find(".version"),o=n.data("name"),s=n.data("version"),s=t.attr("aria-label").replace("%s",s),o=(n.addClass("disabled"),u.i18n.sprintf(u.i18n.__("Updating %s...","hellopack-client"),o));n.attr("aria-label",o),t.text(s),n.removeClass("updating-message").addClass("updated-message"),n.text(u.i18n.__("Updated!","hellopack-client")),u.a11y.speak(o),a.addClass("update-complete").delay(1e3).fadeOut(),u.hellopack.decrementCount("plugin"),u.hellopack.updateDoneSuccessfully=!0,u.hellopack.updateLock=!1,i(document).trigger("hellopack-update-success",e),u.hellopack.queueChecker()},u.hellopack.updateError=function(e){var t;u.hellopack.updateDoneSuccessfully=!1,e.errorCode&&"unable_to_connect_to_filesystem"===e.errorCode&&u.hellopack.shouldRequestFilesystemCredentials?u.hellopack.credentialError(e,"update-plugin"):((t=i(".hellopack-card-"+e.slug).find(".update-now")).data("name"),t.attr("aria-label",u.i18n.__("Updating failed","hellopack-client")),t.removeClass("updating-message"),t.html(u.i18n.sprintf(u.i18n.__("Updating failed %s...","hellopack-client"),"string"!==e.errorMessage?e.errorMessage:e.error)),u.hellopack.updateLock=!1,i(document).trigger("hellopack-update-error",e),u.hellopack.queueChecker())},u.hellopack.showErrorInCredentialsForm=function(e){var t=i(".notification-dialog");t.find(".error").remove(),t.find("h3").after('<div class="error">'+e+"</div>")},u.hellopack.credentialError=function(e,t){u.hellopack.updateQueue.push({type:t,data:{plugin:e.plugin,slug:e.slug}}),u.hellopack.showErrorInCredentialsForm(e.error),u.hellopack.requestFilesystemCredentials()},u.hellopack.queueChecker=function(){var e;u.hellopack.updateLock||u.hellopack.updateQueue.length<=0||(e=u.hellopack.updateQueue.shift(),u.hellopack.updatePlugin(e.data.plugin,e.data.slug))},u.hellopack.requestFilesystemCredentials=function(e){!1===u.hellopack.updateDoneSuccessfully&&(u.hellopack.$elToReturnFocusToFromCredentialsModal=i(e.target),u.hellopack.updateLock=!0,u.hellopack.requestForCredentialsModalOpen())},u.hellopack.keydown=function(e){27===e.keyCode?u.hellopack.requestForCredentialsModalCancel():9===e.keyCode&&("upgrade"!==e.target.id||e.shiftKey?"hostname"===e.target.id&&e.shiftKey&&(i("#upgrade").focus(),e.preventDefault()):(i("#hostname").focus(),e.preventDefault()))},u.hellopack.requestForCredentialsModalOpen=function(){var e=i("#request-filesystem-credentials-dialog");i("body").addClass("modal-open"),e.show(),e.find("input:enabled:first").focus(),e.keydown(u.hellopack.keydown)},u.hellopack.requestForCredentialsModalClose=function(){i("#request-filesystem-credentials-dialog").hide(),i("body").removeClass("modal-open"),u.hellopack.$elToReturnFocusToFromCredentialsModal.focus()},u.hellopack.requestForCredentialsModalCancel=function(){var e;!1===u.hellopack.updateLock&&0===u.hellopack.updateQueue.length||(e=u.hellopack.updateQueue[0].data.slug,u.hellopack.updateLock=!1,u.hellopack.updateQueue=[],u.hellopack.requestForCredentialsModalClose(),(e=i(".hellopack-card-"+e).find(".update-now")).removeClass("updating-message"),e.html(e.data("originaltext")))},u.hellopack.beforeunload=function(){if(u.hellopack.updateLock)return u.i18n.__("Update in progress, really leave?","hellopack-client")},i(document).ready(function(){u.hellopack.shouldRequestFilesystemCredentials=!(i("#request-filesystem-credentials-dialog").length<=0),i("#request-filesystem-credentials-dialog form").on("submit",function(){return u.hellopack.filesystemCredentials.ftp.hostname=i("#hostname").val(),u.hellopack.filesystemCredentials.ftp.username=i("#username").val(),u.hellopack.filesystemCredentials.ftp.password=i("#password").val(),u.hellopack.filesystemCredentials.ftp.connectionType=i('input[name="connection_type"]:checked').val(),u.hellopack.filesystemCredentials.ssh.publicKey=i("#public_key").val(),u.hellopack.filesystemCredentials.ssh.privateKey=i("#private_key").val(),u.hellopack.requestForCredentialsModalClose(),u.hellopack.updateLock=!1,u.hellopack.queueChecker(),!1}),i('#request-filesystem-credentials-dialog [data-js-action="close"], .notification-dialog-background').on("click",function(){u.hellopack.requestForCredentialsModalCancel()}),i('#request-filesystem-credentials-dialog input[name="connection_type"]').on("change",function(){i(this).parents("form").find("#private_key, #public_key").parents("label").toggle("ssh"===i(this).val())}).change(),i(".hellopack-card.plugin").on("click",".update-now",function(e){var t=i(e.target);e.preventDefault(),u.hellopack.shouldRequestFilesystemCredentials&&!u.hellopack.updateLock&&u.hellopack.requestFilesystemCredentials(e),u.hellopack.updatePlugin(t.data("plugin"),t.data("slug"))}),i(".hellopack-card.theme").on("click",".update-now",function(e){var t=i(e.target);e.preventDefault(),u.hellopack.shouldRequestFilesystemCredentials&&!u.hellopack.updateLock&&u.hellopack.requestFilesystemCredentials(e),u.hellopack.updateTheme(t.data("slug"))}),i("#plugin_update_from_iframe").on("click",function(e){var t=window.parent===window?null:window.parent;i.support.postMessage=!!window.postMessage,!1!==i.support.postMessage&&null!==t&&-1===window.parent.location.pathname.indexOf("update-core.php")&&(e.preventDefault(),e={action:"updatePlugin",slug:i(this).data("slug")},t.postMessage(JSON.stringify(e),window.location.origin))})}),i(window).on("message",function(t){t=t.originalEvent;let a;var e=document.location,e=e.protocol+"//"+e.hostname;if(t.origin===e&&t.data){try{a=i.parseJSON(t.data)}catch(e){a=t.data}try{if(void 0===a.action)return}catch(e){}try{switch(a.action){case"decrementUpdateCount":u.hellopack.decrementCount(a.upgradeType);break;case"updatePlugin":tb_remove(),i(".hellopack-card-"+a.slug).find("h4 a").focus(),i(".hellopack-card-"+a.slug).find('[data-slug="'+a.slug+'"]').trigger("click")}}catch(e){}}}),i(window).on("beforeunload",u.hellopack.beforeunload)}(jQuery,window.wp,window.ajaxurl);